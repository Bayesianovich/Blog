<article class="post-detail">
  <!-- Immersive Header (Hidden by default, shown in immersive mode) -->
  <!-- Removed immersive-header div since we use the main banner now -->

  <div class="post-content">
    <%- page.content %>
  </div>

  <% if (theme.reward && theme.reward.enable) { %>
    <div class="reward-container">
      <div class="reward-button" onclick="toggleReward()">
        <i class="fas fa-hand-holding-usd"></i> <%= theme.reward.title || '赞赏' %>
      </div>
      <div id="reward-qr" class="reward-qr">
        <div class="reward-message"><%= theme.reward.message %></div>
        <img src="<%= theme.reward.qrcode %>" alt="Reward QR">
      </div>
    </div>
    <script>
      function toggleReward() {
        var qr = document.getElementById('reward-qr');
        qr.classList.toggle('active');
      }
    </script>
  <% } %>

  <div class="post-footer">
    <!-- Footer content if needed, e.g. Share, Previous/Next -->
    
    <!-- Giscus Comments -->
    <div id="comments" style="margin-top: 50px;"></div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var theme = localStorage.getItem('theme') === 'light' ? 'light' : 'dark_dimmed';
        var script = document.createElement('script');
        script.src = "https://giscus.app/client.js";
        script.setAttribute("data-repo", "Bayesianovich/Blog_comment");
        script.setAttribute("data-repo-id", "R_kgDOQ8Miig");
        script.setAttribute("data-category", "Announcements");
        script.setAttribute("data-category-id", "DIC_kwDOQ8Miis4C1G63");
        script.setAttribute("data-mapping", "pathname");
        script.setAttribute("data-strict", "0");
        script.setAttribute("data-reactions-enabled", "1");
        script.setAttribute("data-emit-metadata", "0");
        script.setAttribute("data-input-position", "bottom");
        script.setAttribute("data-theme", theme);
        script.setAttribute("data-lang", "zh-CN");
        script.setAttribute("crossorigin", "anonymous");
        script.async = true;
        document.getElementById('comments').appendChild(script);
      });
    </script>
  </div>
</article>

<script>
  function toggleImmersiveMode() {
    document.body.classList.toggle('immersive-mode');
    var btn = document.getElementById('immersive-toggle');
    var icon = btn.querySelector('i');
    
    if (document.body.classList.contains('immersive-mode')) {
      icon.classList.remove('fa-expand');
      icon.classList.add('fa-compress');
      btn.innerHTML = '<i class="fas fa-compress"></i> Exit Immersive';
    } else {
      icon.classList.remove('fa-compress');
      icon.classList.add('fa-expand');
      btn.innerHTML = '<i class="fas fa-expand"></i> Immersive Reading';
    }
  }
</script>